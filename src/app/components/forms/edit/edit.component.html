<div class="edit-profile-container">
    @if (userData) {
    <div class="edit-profile-card">
        <h2>Editar Perfil</h2>

        <div class="profile-image-edit">
            <div class="current-image">
                @if (userData.fotoPerfil) {
                    <img [src]="userData.fotoPerfil" alt="Foto de perfil">
                } @else {
                    <i class="bi bi-person-circle" style="font-size: 80px;"></i>
                }
            </div>
            <div class="image-upload">
                <label for="file-input" class="btn btn-success">
                    <i class="bi bi-camera me-2"></i>Cambiar foto
                </label>
                <input id="file-input" 
                       type="file" 
                       (change)="onFileSelected($event)"
                       accept="image/*">
            </div>
        </div>

        <form #editForm="ngForm">
            <div class="form-group">
                <label for="nombre">Nombre</label>
                <input type="text" 
                       class="form-control" 
                       id="nombre" 
                       name="nombre"
                       [(ngModel)]="userData.nombre"
                       [class.is-invalid]="errors['nombre']">
                @if (errors['nombre']) {
                    <div class="alert alert-danger">{{ errors['nombre'] }}</div>
                }
            </div>

            <div class="form-group">
                <label for="apellido">Apellidos</label>
                <input type="text" 
                       class="form-control" 
                       id="apellido" 
                       name="apellido"
                       [(ngModel)]="userData.apellido"
                       [class.is-invalid]="errors['apellido']">
                @if (errors['apellido']) {
                    <div class="alert alert-danger">{{ errors['apellido'] }}</div>
                }
            </div>

            <div class="form-group">
                <label for="email">Correo electrónico</label>
                <input type="email" 
                       class="form-control" 
                       id="email" 
                       name="email"
                       [(ngModel)]="userData.email"
                       [class.is-invalid]="errors['email']">
                @if (errors['email']) {
                    <div class="alert alert-danger">{{ errors['email'] }}</div>
                }
            </div>

            <div class="form-group">
                <label for="telefono">Teléfono</label>
                <input type="tel" 
                       class="form-control" 
                       id="telefono" 
                       name="telefono"
                       [(ngModel)]="userData.telefono"
                       [class.is-invalid]="errors['telefono']">
                @if (errors['telefono']) {
                    <div class="alert alert-danger">{{ errors['telefono'] }}</div>
                }
            </div>

            <div class="form-group">
                <label for="rol">Rol</label>
                <input type="text" 
                       class="form-control readonly-field" 
                       id="rol" 
                       [value]="userData.rol | titlecase"
                       readonly>
            </div>

            <div class="profile-actions">
                <button type="button" 
                        class="btn btn-success animated-button"
                        (click)="guardarCambios()"
                        [disabled]="loading">
                    @if (loading) {
                        <span class="spinner-border spinner-border-sm me-2"></span>
                    }
                    <i class="bi bi-check-circle me-2"></i>Guardar cambios
                </button>
                <button type="button" 
                        class="btn btn-secondary animated-button"
                        (click)="cancelar()"
                        [disabled]="loading">
                    <i class="bi bi-x-circle me-2"></i>Cancelar
                </button>
            </div>
        </form>
    </div>
    } @else {
    <div class="alert alert-warning">
        No se encontraron datos del usuario. <a routerLink="/signIn">Iniciar sesión</a>
    </div>
    }
</div>
